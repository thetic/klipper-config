[gcode_macro M106]
description: Set fan speed
rename_existing: M99106
gcode:
    {% set S = params.S | default(255) | int %}

    {% if (params.P is not defined) or (params.P|int == 1) %}
        M99106 S{S}
    {% endif %}

    {% if ((params.P is not defined) or (params.P|int == 1)) and ('fan_generic auxiliary' in printer) %}
        {% set SPEED = S|float / 255 %}
        SET_FAN_SPEED FAN=auxiliary SPEED={S|float / 255}
    {% endif %}

[gcode_macro M107]
description: Turn fan off
rename_existing: M99107
gcode:
    {% if (params.P is not defined) or (params.P|int == 1) %}
        M99107
    {% endif %}

    {% if ((params.P is not defined) or (params.P|int == 1)) and ('fan_generic auxiliary' in printer) %}
        SET_FAN_SPEED FAN=auxiliary SPEED=0
    {% endif %}
