[include air_filter.cfg]

[sgp40]

[temperature_sensor nevermore_intake]
sensor_type: BME280
i2c_address: 119

[temperature_sensor nevermore_exhaust]
sensor_type: BME280
i2c_address: 119

[temperature_sensor nevermore_intake]
sensor_type: SGP40
ref_temp_sensor: bme280 nevermore_intake
ref_humidity_sensor: bme280 nevermore_intake

[temperature_sensor nevermore_exhaust]
sensor_type: SGP40
ref_temp_sensor: bme280 nevermore_exhaust
ref_humidity_sensor: bme280 nevermore_exhaust

[servo _vent]

[delayed_gcode VENT_DEACTIVATE]
gcode:
    SET_SERVO SERVO=_vent WIDTH=0

[gcode_macro VENT_OPEN]
description: Open the filter exhaust vent
variable_angle: 122
gcode:
    SET_SERVO SERVO=_vent ANGLE={angle}
    UPDATE_DELAYED_GCODE ID=VENT_DEACTIVATE DURATION=1

[gcode_macro VENT_CLOSE]
description: Seal the filter exhaust vent
gcode:
    {% set angle = printer['gcode_macro VENT_OPEN'].angle + 40 | float %}
    SET_SERVO SERVO=_vent ANGLE={angle}
    UPDATE_DELAYED_GCODE ID=VENT_DEACTIVATE DURATION=1
