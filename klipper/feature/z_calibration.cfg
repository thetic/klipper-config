[z_calibration]

[gcode_macro CALIBRATE_Z]
description: Automatically calibrates the nozzle offset to the print surface
rename_existing: _CALIBRATE_Z
gcode:
    {% if '_CheckProbe' in printer.gcode.commands %}
        _CheckProbe action=query
        G90
        ATTACH_PROBE
    {% endif %}

    {% if 'STATUS_CALIBRATING_Z' in printer.gcode.commands %}
        STATUS_CALIBRATING_Z
    {% endif %}

    _CALIBRATE_Z {rawparams}

    {% if '_CheckProbe' in printer.gcode.commands %}
        DOCK_PROBE
    {% endif %}

    {% if 'STATUS_READY' in printer.gcode.commands %}
        STATUS_READY
    {% endif %}
